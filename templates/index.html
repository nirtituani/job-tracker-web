{% extends "base.html" %}

{% block title %}Applications - Job Tracker{% endblock %}

{% block content %}
<!-- Stats Dashboard -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total }}</div>
        <div class="stat-label">Total Applications</div>
    </div>
    {% for status, count in status_counts.items() %}
    <div class="stat-card">
        <div class="stat-number">{{ count }}</div>
        <div class="stat-label">{{ status }}</div>
    </div>
    {% endfor %}
</div>

<!-- Search and Filter -->
<div class="filter-section">
    <form method="GET" action="{{ url_for('index') }}">
        <div class="filter-row">
            <input type="text" 
                   name="search" 
                   class="form-input" 
                   placeholder="ğŸ” Search company, title, location..." 
                   value="{{ search }}"
                   style="flex: 1;">
            
            <select name="status" class="form-select" onchange="this.form.submit()" style="flex: 0 0 150px;">
                <option value="All" {% if status_filter == 'All' %}selected{% endif %}>All Status</option>
                <option value="Applied" {% if status_filter == 'Applied' %}selected{% endif %}>Applied</option>
                <option value="Phone Screen" {% if status_filter == 'Phone Screen' %}selected{% endif %}>Phone Screen</option>
                <option value="First Interview" {% if status_filter == 'First Interview' %}selected{% endif %}>First Interview</option>
                <option value="Second Interview" {% if status_filter == 'Second Interview' %}selected{% endif %}>Second Interview</option>
                <option value="Third Interview" {% if status_filter == 'Third Interview' %}selected{% endif %}>Third Interview</option>
                <option value="Final Interview" {% if status_filter == 'Final Interview' %}selected{% endif %}>Final Interview</option>
                <option value="Offer Received" {% if status_filter == 'Offer Received' %}selected{% endif %}>Offer Received</option>
                <option value="Rejected" {% if status_filter == 'Rejected' %}selected{% endif %}>Rejected</option>
                <option value="Ghosted" {% if status_filter == 'Ghosted' %}selected{% endif %}>Ghosted</option>
                <option value="Withdrawn" {% if status_filter == 'Withdrawn' %}selected{% endif %}>Withdrawn</option>
            </select>
        </div>
    </form>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="btn-group">
        <a href="{{ url_for('add_application') }}" class="btn btn-success">â• Add Application</a>
        <a href="{{ url_for('export_csv') }}" class="btn btn-primary">ğŸ’¾ Export CSV</a>
    </div>
</div>

<!-- Applications List -->
{% if applications %}
<div class="app-list">
    {% for app in applications %}
    <div class="app-item">
        <div class="app-header">
            <div>
                <div class="app-company">{{ app.company_name }}</div>
                <div class="app-title">{{ app.job_title }}</div>
            </div>
            <span class="app-status 
                {% if app.status == 'Applied' %}status-applied
                {% elif app.status == 'Phone Screen' or 'Interview' in app.status %}status-interview
                {% elif app.status == 'Offer Received' %}status-offer
                {% elif app.status == 'Rejected' %}status-rejected
                {% else %}status-applied{% endif %}">
                {{ app.status }}
            </span>
        </div>
        
        <div class="app-meta">
            {% if app.location %}
            <span>ğŸ“ {{ app.location }}</span>
            {% endif %}
            <span>ğŸ“… {{ app.date_applied }}</span>
            {% if app.job_match %}
            <span class="app-match">
                <span class="stars">
                    {% for i in range(app.job_match) %}â­{% endfor %}
                </span>
                ({{ app.job_match }})
            </span>
            {% endif %}
        </div>
        
        {% if app.notes %}
        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
            {{ app.notes[:100] }}{% if app.notes|length > 100 %}...{% endif %}
        </div>
        {% endif %}
        
        <div class="app-actions">
            <a href="{{ url_for('view_application', id=app.id) }}" class="btn btn-primary btn-sm">ğŸ‘ï¸ View</a>
            <a href="{{ url_for('edit_application', id=app.id) }}" class="btn btn-success btn-sm">âœï¸ Edit</a>
            <a href="{{ url_for('delete_application', id=app.id) }}" 
               class="btn btn-danger btn-sm"
               onclick="return confirm('Are you sure you want to delete this application?')">ğŸ—‘ï¸ Delete</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card text-center">
    <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</p>
    <h2>No Applications Found</h2>
    <p style="color: #666; margin: 1rem 0;">Start tracking your job search by adding your first application!</p>
    <a href="{{ url_for('add_application') }}" class="btn btn-success">â• Add Your First Application</a>
</div>
{% endif %}
{% endblock %}
